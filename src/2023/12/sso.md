## 单点登录

> 单点登录有个简称是 **<font size=6>sso</font>**，它是一个功能可以 **<font size=4>控制多个</font>** **<font size=4>有联系的</font>** 系统操作，简单地理解为通过单点登录可以让用户 **<font size=4>只需要登录一次</font>** 软件或者系统，那么同系统下的平台都可以免去再次注册、验证、访问权限的麻烦程序，通俗易懂的理解为 **<font size=4>一次性登录</font>** 也可以 **<font size=4>一次性下线</font>**

为什么需要单点登录？

传统登录流程：用户进入系统--->未登录--->跳转登录页面--->登录（各种方式）---> 验证后，设置cookie在本地，服务器存放session---> 业务中请求带上cookie，如果多个系统都需要登录，且切换频繁，那用户在不同系统间需要多次登录，很不友好

### 两种不同需求下的sso

1. 相同域名：不同子域名之间，在浏览器端，根据同源策略，不同子域名的cookie不能共享。所以设置SSO的域名为根域名。SSO登录验证后，子域名可以访问根域名的 cookie，即可完成校验。

```js
    // Cookie的 domain属性设置为父域的域名（主域名），同时将 Cookie 的path属性设置为根路径，将 Session ID（或 Token）保存到父域中。这样所有的子域应用就都可以访问到这个Cookie
```

2. 不同域名：用户登录子系统时未登录，跳转到 SSO 登录界面，成功登录后，SSO 生成一个 ST （service ticket ）。用户登录不同的域名时，都会跳转到 SSO，然后 SSO 带着 ST 返回到不同的子域名，子域名中发出请求验证 ST 的正确性（防止篡改请求）

### sso登录流程

1. 用户访问网站a.com
2. 由于没有登录，会重定向到认证中心，并带上回调` www.sso.com?return_uri=a.com`
3. 认证中心判断没有登录，打开登录窗口
4. 完成登录，重定向到a.com并带上 **授权码**，`www.a.com?ticket=xxx`同时认证中心保存一个cookie
5. a.com中，拿着ticket去验证有效性
6. 验证完成，服务器返回登录信息cookie保存本地
7. 访问其他页面带上cookie,正常访问

此时访问b.com页面

1. b.com未保存cookie,重定向到认证中心
2. 认证中心已经有登录信息，直接重定向到`www.b.com?ticket=xxx`
3. b.com,拿着ticket去验证有效性
4. 验证完成，服务器返回登录信息cookie保存本地
5. 访问其他页面带上cookie,正常访问

### 退出登录

任何一个页面退出登录，向认证中心发出退出登录api,完成退出
